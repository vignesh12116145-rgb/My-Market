name: Market Advisor Bot - Twice Daily + Breaking News

on:
  schedule:
    # MAIN UPDATES - TWICE DAILY
    # Morning Update: 3:30 AM UTC = 9:00 AM IST
    - cron: '30 3 * * *'
    
    # Evening Update: 12:30 PM UTC = 6:00 PM IST
    - cron: '30 12 * * *'
    
    # BREAKING NEWS CHECK - Every 2 hours during market hours
    - cron: '0 4,6,8,10,12 * * 1-5'  # 9:30 AM to 6:00 PM IST on weekdays
    
  workflow_dispatch:  # Manual trigger anytime
  push:
    branches: [ main, master ]

jobs:
  run-market-advisor:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
      
      - name: Setup Python 3.9
        uses: actions/setup-python@v5
        with:
          python-version: '3.9'
      
      - name: Cache Dependencies
        uses: actions/cache@v4
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-
      
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Run Market Advisor Bot
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
          GITHUB_ACTIONS: "true"
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ğŸ¤µ Market Advisor Bot"
          echo "ğŸ“… $(date '+%Y-%m-%d %H:%M:%S UTC')"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Starting market analysis..."
          python market_app.py
          echo ""
          echo "âœ… Execution completed!"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
