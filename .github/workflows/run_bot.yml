name: Master Financial Advisor Bot

on:
  schedule:
    # Run every 4-5 hours throughout the day
    - cron: '0 0,5,10,15,20 * * *'     # 12am, 5am, 10am, 3pm, 8pm UTC
    - cron: '30 2,7,12,17,22 * * *'     # 2:30am, 7:30am, 12:30pm, 5:30pm, 10:30pm UTC
  workflow_dispatch:  # Allow manual trigger
  push:
    branches: [ main, master ]

jobs:
  run-financial-advisor:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
      
      - name: Setup Python 3.9
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      
      - name: Cache Dependencies
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-
      
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests yfinance pyTelegramBotAPI feedparser beautifulsoup4 lxml
      
      - name: Run Financial Advisor Bot
        env:
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }}
          GITHUB_ACTIONS: "true"
        run: |
          echo "Starting Master Financial Advisor Bot..."
          python master_advisor.py
          echo "Bot execution completed!"
      
      - name: Upload Logs (if any)
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: bot-logs
          path: |
            *.log
            sent_news.txt
          retention-days: 7
